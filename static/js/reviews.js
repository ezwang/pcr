// Generated by CoffeeScript 1.10.0
(function() {
  window.toggle_choose_cols = function() {
    return $("#choose-cols").toggle();
  };

  window.toggle_choose_cols_all = function() {
    if ($("#choose-cols input[type='checkbox'][name='all']").prop("checked")) {
      return $("#choose-cols input[type='checkbox']").prop("checked", true);
    } else {
      return $("#choose-cols input[type='checkbox']").prop("checked", false);
    }
  };

  window.submit_choose_cols = function() {
    var boxes, i, j, ref, result;
    boxes = $("#choose-cols input[type='checkbox']");
    result = [];
    for (i = j = 0, ref = boxes.length - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
      if ($(boxes[i]).prop("checked")) {
        result.push($(boxes[i]).attr("value"));
      }
    }
    $.cookie("pcr_choosecols", result.join(), {
      path: '/'
    });
    toggle_choose_cols();
    return set_cols(result);
  };

  window.cancel_choose_cols = function() {
    var cols, i, j, ref;
    $("#choose-cols input[type=checkbox]").prop("checked", false);
    cols = $.cookie("pcr_choosecols").split(",");
    for (i = j = 0, ref = cols.length - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
      $("#choose-cols input[name='" + cols[i] + "']").prop("checked", true);
    }
    return toggle_choose_cols();
  };

  window.set_viewmode = function(view_id) {
    if (("" + view_id) === "0") {
      $("#view_average").addClass("selected");
      $("#view_recent").removeClass("selected");
      $(".cell_average").show();
      $(".cell_recent").hide();
      $(".section-table tbody").find("tr:not(:first)").show();
    } else {
      $("#view_average").removeClass("selected");
      $("#view_recent").addClass("selected");
      $(".cell_average").hide();
      $(".cell_recent").show();
      $(".section-table tbody").find("tr:not(:first)").hide();
    }
    $.cookie("pcr_viewmode", view_id, {
      path: '/'
    });
    return $('#course-table').trigger('update');
  };

  window.viewmode = function() {
    return $.cookie('pcr_viewmode');
  };

  window.set_cols = function(cols) {
    var i, j, ref, results;
    $("#course-table th").hide();
    $("#course-table td").hide();
    $("#course-table .col_icon").show();
    $("#course-table .col_code").show();
    $("#course-table .col_name").show();
    $("#course-table .col_instructor").show();
    $("#course-table .col_semester").show();
    $("#course-table .col_section").show();
    $("#course-table .col_responses").show();
    $("#course-table .td_hidden").show();
    $("#course-table .sec_td_hidden").show();
    results = [];
    for (i = j = 0, ref = cols.length - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
      results.push($("#course-table .col_" + cols[i]).show());
    }
    return results;
  };

  window.start_sort_rows = function() {
    return $("#course-table .row_hidden").appendTo($("div#hidden"));
  };

  window.end_sort_rows = function() {
    return $("#course-table .row_display").each(function() {
      var index;
      index = $(this).attr("id").substr(12);
      return $(this).after($("#row_hidden_" + index));
    });
  }; 

  $(document).ready(function() {
    $('.sec_row_hidden').hide();
    if ($.cookie("pcr_viewmode") == null) {
      $.cookie("pcr_viewmode", "0", {
        path: '/'
      });
    }
    set_viewmode($.cookie("pcr_viewmode"));

    const table = $("#course-table").DataTable({
        columnDefs: [
            {
                targets: [-1],
                visible: false
            }
        ],
        autoWidth: false,
        language: {
            searchPlaceholder: "Search Table",
            search: ""
        }
    });
    table.columns().visible(false);
    table.columns([0, 1, 2, 3, 4]).visible(true);

    // create a div element for the button
    var btn_div = document.createElement("div");
    btn_div.setAttribute("class", "btn-group dropleft");
    $( "#course-table_filter" ).prepend( btn_div );
    var btn = document.createElement("button");
    btn.setAttribute("type", "button");
    btn.setAttribute("id", "dropdownMenuButton");
    btn.setAttribute("class", "btn btn-secondary btn-sm dropdown-toggle");
    btn.setAttribute("data-toggle", "dropdown");
    btn.setAttribute("aria-haspopup", "true");
    btn.setAttribute("aria-expanded", "false");
    btn.innerHTML = "<i class='fa fa-plus'></i>"
    $( ".btn-group.dropleft" ).prepend( btn );
    // create a div element for the drop down menu
    var div = document.createElement("div");
    // set atrributes for div element 
    div.setAttribute("class", "dropdown-menu");
    div.setAttribute("aria-labelledby", "dropdownMenuButton");
    // create dropdown menu inside div
    div.innerHTML = "<a class='dropdown-item' id='course'>Course Quality</a> \
    <a class='dropdown-item' id='instructor-quality'>Instructor Quality</a> \
    <a class='dropdown-item' id='difficulty'>Difficulty</a> \
    <a class='dropdown-item' id='learned'>Amount Learned</a> \
    <a class='dropdown-item' id='work'>Amount of Work</a> \
    <a class='dropdown-item' id='value'>Value of Readings</a> \
    <a class='dropdown-item' id='communication'>Instructor Communication</a> \
    <a class='dropdown-item' id='accessibility'>Instructor Accessibility</a> \
    <a class='dropdown-item' id='interest'>Ability to Stimulate Interest</a> \
    <a class='dropdown-item' id='ta'>TA Quality</a> \
    <a class='dropdown-item' id='majors'>Recommended for Majors</a> \
    <a class='dropdown-item' id='non-majors'>Recommended for Non-Majors</a>"
    $( ".btn-group.dropleft" ).prepend( div );
    // $('.dropdown-item').bind('click', function (e) { e.stopPropagation});
    $('.dropdown-menu').click(function(e) {
      e.stopPropagation();
    });

    // 4 columns are visible by default and should be highlighted gray in the dropdown menu
    // be default
    $('#course').css("background-color", "rgb(211,211,211,0.5)");
    $('#instructor-quality').css("background-color", "rgb(211,211,211,0.5)");
    $('#difficulty').css("background-color", "rgb(211,211,211,0.5)");
    $('#learned').css("background-color", "rgb(211,211,211,0.5)");

    var col_ids = ['.', 'course', 'instructor-quality', 'difficulty', 'learned', 'work', 'value', 
    'communication','accessibility', 'interest', 'ta', 'majors', 'non-majors'];
    // attempt to condense code in a for loop
     /*for (var i = 1; i < 13; i++) {
      $('#' + col_ids[i]).click(function() {
        // get current visibility
        var visible = table.column(i).visible();
        if (visible) {
          table.column(i).visible(false);
          $('#' + col_ids[i]).css("background-color", "white");
        }
        else {
          table.column(i).visible(true);
          $('#' + col_ids[i]).css("background-color", "rgb(211,211,211,0.5)");
        }
      });
    } */

    // event handler for dropdown-item
    // get id of whatever's being clicked
    // toggle accordingly 
    /*$('.dropdown-item').click(toggle); 

    var toggle = function() {
        table.column(col_ids.indexOf(this.id)) === true ? 
        table.column(col_ids.indexOf(this.id)).visible(false) 
        : table.column(col_ids.indexOf(this.id)).visible(true); 
    };*/

    $('#course').click(function() {
        // get current visibility
        var visible = table.column(1).visible();
        if (visible) {
          table.column(1).visible(false);
          $('#course').css("background-color", "white");
        }
        else {
          table.column(1).visible(true);
          $('#course').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#instructor-quality').click(function() {
        var visible = table.column(2).visible();
        if (visible) {
          table.column(2).visible(false);
          $('#instructor-quality').css("background-color", "white");
        }
        else {
          table.column(2).visible(true);
          $('#instructor-quality').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#difficulty').click(function() {
        var visible = table.column(3).visible();
        if (visible) {
          table.column(3).visible(false);
          $('#difficulty').css("background-color", "white");
        }
        else {
          table.column(3).visible(true);
          $('#difficulty').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#learned').click(function() {
        var visible = table.column(4).visible();
        if (visible) {
          table.column(4).visible(false);
          $('#learned').css("background-color", "white");
        }
        else {
          table.column(4).visible(true);
          $('#learned').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#work').click(function() {
        var visible = table.column(5).visible();
        if (visible) {
          table.column(5).visible(false);
          $('#work').css("background-color", "white");
        }
        else {
          table.column(5).visible(true);
          $('#work').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#value').click(function() {
        var visible = table.column(6).visible();
        if (visible) {
          table.column(6).visible(false);
          $('#value').css("background-color", "white");
        }
        else {
          table.column(6).visible(true);
          $('#value').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#communication').click(function() {
        var visible = table.column(7).visible();
        if (visible) {
          table.column(7).visible(false);
          $('#communication').css("background-color", "white");
        }
        else {
          table.column(7).visible(true);
          $('#communication').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#accessibility').click(function() {
        var visible = table.column(8).visible();
        if (visible) {
          table.column(8).visible(false);
          $('#accessibility').css("background-color", "white");
        }
        else {
          table.column(8).visible(true);
          $('#accessibility').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#interest').click(function() {
        var visible = table.column(9).visible();
        if (visible) {
          table.column(9).visible(false);
          $('#interest').css("background-color", "white");
        }
        else {
          table.column(9).visible(true);
          $('#interest').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#ta').click(function() {
        var visible = table.column(10).visible();
        if (visible) {
          table.column(10).visible(false);
          $('#ta').css("background-color", "white");
        }
        else {
          table.column(10).visible(true);
          $('#ta').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#majors').click(function() {
        var visible = table.column(11).visible();
        if (visible) {
          table.column(11).visible(false);
          $('#majors').css("background-color", "white");
        }
        else {
          table.column(11).visible(true);
          $('#majors').css("background-color", "rgb(211,211,211,0.5)");
        }
    });
    $('#non-majors').click(function() {
        var visible = table.column(12).visible();
        if (visible) {
          table.column(12).visible(false);
          $('#non-majors').css("background-color", "white");
        }
        else {
          table.column(12).visible(true);
          $('#non-majors').css("background-color", "rgb(211,211,211,0.5)");
        }
    }); 
  });

}).call(this);
